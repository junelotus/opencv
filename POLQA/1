#
ITU-T P.861 主要作用于识别编解码器的影响。
ITU-T P.863 主要用于评估目前和不久的将来使用的多种编码、传输和语音增强技术的语音值俩女。
表1展示了包含在要求规范中的因素和应用，并且用在了863算法的选择阶段，在各个因素下的表现并没有在表1中展示。
表2中展示了一些本算法不打算使用的情况

表3提供了一些进一步调查需要用到的实验变量，或者863在与这些变量使用的时候会被认为是提供了不准确的预测的测试变量。

表4列举了863还没有验证的因素 技术和应用。

863不可以代替主观测试。

863没有对传输质量提供一个综合评价。它只测量单向语音失真和噪声对语音质量的影响。延迟、侧音和回声和其他双向交互有关的损伤，没有反映在863评分中，有可能有高的评分的会话，整体质量会很差。

表1:
测试因素：
·PCM类型的编解码器丢包和丢包隐藏
·语音的时间和幅度的剪辑
·线性失真，包含带宽限制 和 光谱整形（非平坦概率响应）
·频率响应

863的目的是预测从用户感受到的低带宽到超宽频通信场景的整体语音质量。这通常考虑在没有噪声和有噪声的通信环境中的所有语音处理模块组件。'listening speech quality' 的意思是跟君[ITU-T P.800] or [ITU-T P.830]中的绝对类别评级实验中被人们课题感知和打分的整体语音质量。
在超宽频情况下，863在MOS ACR超宽频尺度上进行预测打分。Appendix II.提供了超宽频实验的具体细节。在窄带宽模式下，863在MOS ACR 窄带宽尺度上进行预测打分。有两种不同模式的输出。.
与[b-ITU-T P.861]和[b-ITU-T P.862]一样，863方法被称为”全参考”或者“双端”，意味着质量预测是机遇未失真的参考信号和接受端信号之间的比较。
ITU-T P.863可用于电子接口记录的信号(如[b-ITU-T P.862])，也可用于SWB操作模式下使用人工耳模拟器记录的信号。其他技术或组件，如语音存储格式，或非电话应用程序，如公共安全网络或专业移动电台连接，不在竞争和选择标准之列。

page4:
理解863提供的两种模式
superwideband ： 超宽频
narrowband ：窄频带
两种模式唯一的区别在于相关的语音信号使用的带宽。

在superwideband模式，在接收端（可能退化）的语音信号和相关superwideband下的做对比，。因此，带宽限制被看作是退化，并且会相应地被打分。听力质量被模拟为一个人类听众使用扩散场均衡耳机与双耳呈现(相同的信号在两个耳帽)感知。该预测使用了SWB听力质量量表，其中ITU-T P.863算法在MOS-LQOsw = 4.75处饱和，适用于透明的SWB信号。在ITU-T P.863评估阶段，对超宽带信号进行ITU-T P.800 ACR听力测试。


在narrowband模式，接受端的语音信号要和narrowband相关的信号做比较，因此正常的电话带宽限制不算事严重的退化，并且打分较少。这种窄带模式与之前开发的[b-ITU-T P.862]和[b-ITU-T P.862.1]等模型保持兼容。听力质量被模拟为人类听众在一只耳朵上使用松散耦合的IRS类型的听筒所感知到的(单调的表示)。预测使用常见的窄带收听质量等级，其中ITU-T P.863算法在MOS-LQOn = 4.5处饱和，用于透明窄带信号。


NOTE 1 – For the two operational modes, the quality ratings are obtained on two different scales, namely the traditional scale for the narrowband mode and the future oriented scale for the superwideband mode.

注1:对于两种操作模式，质量评级是在两种不同的尺度上获得的，即窄频带模式的传统尺度和超宽带模式的面向未来的尺度。

注2:声学记录，以及演示级别的影响，只能在超宽带操作模式下预测。窄带工作模式仅限于电子录音，为了与[b-ITU-T P.862]和[b-ITU-T P.862.1]的应用领域相兼容，有一个象征性的表示。


6.算法概述：
将参考信号x(t)和失真信号y(t)进行比较，其中y(t)是x(t)经过传输系统得到的信号。
863算法的输出是在主观听力测试中的课题中，将要给y(t)的感受质量的预测。
ITU-T P.863算法的输出是对主观听力测试中受试者给予Y(t)的感知质量的预测。

在第一步，参考信号和退化信号（传输接收端的信号）都被分为了非常小的时间片段，在下文中被当作 帧 来提到。然后，在参考信号中的每一帧的相对于相关失真信号的延迟被计算出来。基于发现有延迟的基础上，对退化信号的采样率进行估计，如果估计出来的信号显著地不同于参考信号，不管是那个信号有较高的采样率都应该下采样，并且重新定义延迟。
基于延迟的发现，863算法在实验中使用感知模型对比原始信号和对其的退化信号，就如图1所示。此工程最主要的点在于转化参考信号和退化信号为内部表示，这个表示模拟了音频在人类听觉系统的物理表示。考虑知觉频率和响度。着在以下几个步骤中实现：
1.时间对其
2.对齐校准的听力水平
3.时间频度上的映射
4.频率扭曲
5.压缩响度缩放

863算法在超宽频下将回放水平作为感知质量预测的因素；回放级别是相对于-26 dBov的标称级别计算的，在diotic表示为73 dB(a) SPL。
在窄带操作模式下，ITU-T P.863算法用于确定在79 dB(a) SPL的恒定收听水平下的收听语音质量。

内部表达水平的运行时为了将例如本地增益变化和线性滤波等因素考虑进来，想这些影响，如果不是太大的话，对感知的意义比较小。补偿只进行了一部分，被之前帧计算出来的模型 ，模型计算出来的因素被移动平均策略所考虑进去，因此补偿滞后于效果。因此，参考信号和退化信号之间的微小稳态差异补偿。更严重的影响以及迅速的变化只能得到部分补偿，意味着残余的影响仍然存在，导致整体的感知障碍。
而且，863算法在参考信号中消除了比较小的噪声，尽管噪声在退化信号中也部分被压制了。在原始信号中中的操作会改变原始信号的属性，在一个理想化的过程中发现其合理性，这就是受试者通常所说的理想环境。这种理想环境是在主管测试的结果上定义和建模的，当音色不好或者有较低噪声的时候，一些参考录音在主管评价的时候得到较低的分数。所有的主观测试都是在没有与参考信号(绝对类别评级)进行直接比较的情况下进行的，因此，在测试期间，个体受试者所作的、其观点所依据的理想信号假设是未知的。对退化信号的算法运算，在计算内部差分函数之前改变其特征，这是由高级认知过程证明的。众所周知的例子是对线性频响畸变和稳态宽带噪声的相对不敏感;这种建模方法允许一个人通过少量的质量指标来描述最终的质量感知，这些质量指标用于建模所有相关的主观影响。ITU-T P.863在认知模型中计算了六个质量指标:
1.频率响应指标器
2.噪声指标
3.房间混响指标器
4.三个指标描述时间-距-响度的内部差异



第9章：算法描述

图2到图11用方框图概括了算法
图2:是概述
图3-6是时间序列
图7-9是感知模型的核心部分
图11是掩码
图10是863分数的最终确定

9.1 概述
图2所示：算法的输入是用两个16bit的vector代表的波形，第一个是参考波形，第二个是退化之后的波形，863算法包含了采样率的转换，为了补偿不同下采样率输入的波形，。时间对齐，采样率估计，实际的核心模型，构成了MOS计算。
首先，两者之间的延迟被计算，并且相关的采样率被计算。采样率的计算是基于 通过时间对其计算出的延迟的基础上的。如果采样率相差接近1%的话，有较高采样率的信号会被降采样。在每一步之后，结果和一个平均延迟可靠性指示器存储在一起，该指示器是对延迟估计质量的一种度量。最后选择总体可靠性最高的重采样结果。一旦正确的延迟被估计出来并且采样率的不同被补偿，信号和延迟信息被传入感知模型，模型计算感知能力和失真，并且把这个映射到到MOS尺度。



9.2 时间配准（信号对齐精度）
含义：
1.将信号分为等距离的帧对，为每个帧对计算延迟
2.只要有可能，就在参考信号中搜索退化信号的匹配，反之不必。
3.逐步细化每一帧的延迟，从而避免较长时间范围的搜索(长时间的范围搜索需要更大的计算力，与按时间比例调整的输入信号相结合是至关重要的)

信号精度对齐包含主块滤波，预对比，粗对比和精对比。
输入的模块分成等距的宏帧，每一个宏帧的长度取决于采样率。
每一个宏帧的延迟将被计算。计算出来的延迟通常是参考信号和退化信号之间的延迟(此算法通常在参考信号中搜索降噪的部分)。预对准决定了信号的活跃部分（可以使用的部分），计算每个宏块的初始延时估计，每个宏帧的延迟所需的估计搜索范围（检测到的初始延迟的理论上的最大最小变化）
粗对齐为每一帧提供了延迟的迭代细化，使用多维搜索和类似维特比算法的回溯方法过滤检测到的延迟。为了所需的相关长度和搜索范围变小。精细对准最终直接决定了每一帧输入信号的采样延迟，以最大可能的分辨率。在一步中的搜索范围是由粗对准的最后一次迭代决定的。在最后一步，所有几乎具有相同延迟的节被组合起来，被称作“节信息”


时间对齐算法拥有以下特质：
---静态延迟没有特定的限制
---设计来处理少于300ms的可变延迟，但没有硬性规定
---延迟从帧到帧可能会发生改变
---较小的采样率变化（小于2%的）可以被很好地处理，大的采样率变化会被检测到（并且在时间对齐之外被补偿）。
---对时间拉伸或时间压缩的信号，不论有没有基音校正，都能很好地处理。
---即使在信噪比低于0分贝的非常嘈杂的情况下，这种对准也能工作得很好。
---信号电平变化没有出现问题。

9.2.1 一般延迟搜索法
通过分析两个信号之间互相关函数得到的直方图，通过分析直方图来得到信息，将找到的峰值输入直方图中，*将这个两个信号移动一下，然后重复这个步骤*，一旦直方图中包含了足够的数值信息，信号将被过滤，峰值也被确定，两个峰值在直方图中的位置代表了两个信号之间的延迟。

9.2.2 一般延迟可靠性测量
简单的皮尔逊相关来衡量在两个信号中发现的延迟的可靠性。
9.2.3 带通滤波器
在所有的操作之前，两个信号都被带通滤波，滤波器的模型取决于模型的带宽模型（窄带宽模式还是超带宽模式），
在超宽带工作模式下，信号经过带通滤波达到320hz到3400hz。
在窄带工作模式下，信号经带通滤波至290hz至3' 300hz。
注意:那些过滤的信号仅用于时间校准。感知模型使用不同的过滤信号。

9.2.4 预对准
预对准首先识别输出信号中的重新解析点。重新解析点在信号中的位置是从没有语音到有语音的点。重新解析点标记活动语音段的开始，而重新解析段描述从一个重新解析点开始的整个活动语音段。
在信号中的每一个重新解析点定义的重新解析段将被计算出来，重新解析段包含此段的开始和结束时间，以及此段的初始延迟值，对发现的延迟及其准确性的可靠性的指示，即。，一个期望找到准确延迟的上下限。一般过程如图3所示，其步骤将在后续章节中进行说明。
--决定延迟限制
--估计整体的延迟
--定义重新解析点
--在每个重新解析点得到初始延迟
--计算每个宏帧的信息


9.2.4.1 决定延迟限制

这个步骤简单地为延迟的全局搜索范围确定一个确定的上届和下届，该决定基于以下假设：
--参考文件最少还有40%的有效语音，并且至少由两句话组成
--所有的静音部分至少被分为两个部分，典型的是三个部分
--在文件开始之前或者结束之后，不超过50%的静音部分要消失
--语音段不会在两端被切断。

在搜索区域范围中的结果根据以下公式得到：
Flen, Ref Flen, Deg分别是参考信号和输出信号以毫秒为单位的长度，Startsample是检测到的参考信号的开始;这通常是0，但可能是信号中较晚的一点，如果它以一个很长的静默期开始。 

9.2.4.2 全局延迟估计
三个部分
1.第一个做的尝试，是使用互相关函数得到的直方图对整个信号进行匹配。这导致了整体延迟和整体可靠性。在第二步和第三步中，对第一个信号和第二个信号的前半部分 后半部分分别进行了相同的测试，同样会得到另外两个延迟和可靠性值。如果所有的三个延迟在同一个范围内，则整体的延迟被标记为可以接受的和确定的。对于可靠性较低的长信号，可接受延迟的容忍度降低。

整个过程根据信号的对数能量密度进行操作，在帧上取平均值，采样率取决于长度，如表6所示。此帧大小也定义了此步骤中可达到的最佳精度。
注意:对于时间尺度的信号，对整体延迟的估计将是非常不准确的，在大多数情况下甚至是不可用的。然而，如果这个估计被证明是可靠的，那么所有后续校准步骤的工作量就会大大减少。

9.2.4.3 重新解析点的定义
VAD算法将被使用，
连续活动的宏帧的开始部分称为重新解析点，因为这些点类似于完全重新启动延迟测量的点。所谓的重新解析部分信息包含每个重新解析点的活动部分起始点的位置、活动部分的长度、粗略的延迟估计、检测到的延迟的可靠性指示器和准确延迟最有可能被找到的估计范围。此步骤中确定的延迟仅是降级信号中检测到的重新解析部分的起始点与参考信号中相应部分的起始点之差，可能非常不可靠。
对于参考信号来说，活动语音的检测是非常可靠的，但是有噪声的信号除外，可能会非常不准确。因此，普通的vad信息到目前为止不足以指定参考信号和输出信号之间的组合。取而代之的是一个比较复杂的方式，
每个重新解析点最多研究三组潜在的分配:

VAD1，是一个匹配，显然是依赖vad信息的。如果对于信噪比低于35 dB的信号，下一个参考段和降级段的长度相差不超过120 ms，或者对于具有更好的信噪比的信号，下一个参考段和降级段的长度相差不足480 ms，则VAD1段信息被标记为有效。

校正1:仅使用参考信号的VAD信息和总体延迟估计作为搜索位置的提示，在降级信号中搜索参考部分。搜索执行两次，一次在活动部分的开头，一次稍微延迟。两个结果中最好的结果被存储。如果区段足够长，可以找到合理的匹配，那么Corr1信息将被标记为有效。
校正2:利用参考信号的VAD信息和退化信号的VAD信息作为线索，在退化信号中搜索参考部分。搜索执行两次，一次在活动部分的开头，一次稍微延迟。两个结果中最好的结果被存储。如果片段足够长，可以找到合理的匹配，那么Corr2信息将被标记为有效

如果Corr1和Corr2都不能可靠地计算出来，那么该算法就会尝试修改区段，使其适合，例如，将一个大的区段分成两个小的区段。这本身就是危险的，结果只能作为最后的手段。匹配的结果将存储为VAD2。

如果这也没有导致解决方案，则通过使用总体延迟信息应用最佳努力方法。

现在，如果VAD2匹配或整体延迟匹配的结果比基于相关性的方法更好，并且使用了最佳匹配结果，则执行最后的检查。

如果到目前为止最好的解决方案仍然很差，而VAD1匹配很好，则将该解决方案视为退入解决方案。

在此之后，最后检查重叠部分、超限和合理性。如果有任何问题无法解决，则通过使用总体延迟信息重新分配部分，尽管该延迟也可能无效。

该子句中的所有操作都是对信号的能量密度进行的，使用的帧大小与总体延迟估计的帧大小相同(见表6)。

9.2.4.4每个重新解析点的初始延迟计算

到目前为止，每个重新起始点的延迟非常粗糙，因为它主要基于从VAD检索到的信息。对于每个活动部分，这个延迟现在通过多维搜索(使用两个不同的特征日志(能量密度)和分形维数)来细化，每个重新解析部分的两个部分使用两个不同的帧大小。这就产生了关于每一节的延迟的八项建议。选择可靠性最高的方案。如果由重新解析点标识确定的部分的可靠性已经很高，则此部分的搜索将完全跳过。



函数 ：SearchActiveSegments
